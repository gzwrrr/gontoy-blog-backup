# 推送模式

两种推送模式：

1. 推模式
2. 拉模式

| 对比项     | 推模式                                                    | 拉模式                                               |
| ---------- | --------------------------------------------------------- | ---------------------------------------------------- |
| 实时性     | 较好，通过网络管道实时发送                                | 较差                                                 |
| 服务器状态 | 有状态，需要持久化粉丝动态列表                            | 无状态，根据请求实时查询                             |
| 风险项     | 动态的并发「写扩散」问题，大量动态队列持久化造成磁盘高 IO | 大量准点「读扩散」问题，大量并发查询可能会压垮服务器 |
| 应用场景   | 微信                                                      | 微博（早期）                                         |

写扩展优化：

1. 设置上限，比如微信好友上限 5000
2. 限流策略，一定时间内完成消息发布
3. 优化存储策略，采用 NoSQL 或大数据方案

读扩散优化：

1. MQ 削峰填谷，超长队列直接拒绝
2. 增加轮询间隔，减少请求次数
3. 服务端增加缓存，优化查询效率
4. 增加验证码，分散时间，减少机器人刷请求

例子：推特采用了混合模式

1. 小粉丝量采用 Push
2. 大粉丝量采用 Pull



