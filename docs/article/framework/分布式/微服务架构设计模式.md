---
title: "微服务架构设计模式"
shortTitle: "微服务架构设计模式"
description: "微服务架构设计模式"
icon: ""
author: 
  name: gzw
  url: 
  email: 1627121193@qq.com
isOriginal: false
date: 2022-12-12
category: 
- "分布式"
- "小知识点"
- "设计模式"
tag:
- "分布式"
- "小知识点"
- "设计模式"
sticky: 1
star: false
article: true
timeline: true,
dir:
  text: "微服务架构设计模式"
  icon: ""
  collapsible: true
  index: true
  comment: true
headerDepth: 3
index: true
order: 2
copy:
  triggerWords: 100
  disableCopy: false
  disableSelection: false
feed:
  title: "微服务架构设计模式"
  description: "微服务架构设计模式"
  author:
    name: gzw
    email: 1627121193@qq.com
---



# 微服务架构设计模式





原文：https://dzone.com/articles/popular-design-patterns-for-microservices-architec



# API 网关模式

将业务分解为多个微服务带来的问题：

- 如何处理横切关注点：授权、速率控制、负载均衡、重试策略、服务发现
- 如何解决客户端和服务端之间的直接通信会导致过多的流量往返和紧密耦合
- 如何过滤和映射得到数据子集
- 如何将多个微服务的数据进行耦合

**使用 API 网关，具有的功能有：**

- 反向代理
- 请求聚合
- 网关卸载
- 服务发现
- ...



<br/>

# 客户端 UI 组合（SPA）模式

- 每个微服务都由面向业务功能的团队负责开发
- 一些 UI 界面可能需要来自多个微服务的数据，其中每个数据项都由不同的团队维护
- 为了实现这些 UI 团队应该创建一个页面骨架（SPA），通过组合多个 UI 组件来构建页面
- 每个团队开发一个特定于某个服务的客户端 UI 组件

<br/>



# 服务-数据库对应模式

- 微服务需要的是**独立**和**松耦合**
- 在多语言的微服务架构中，每个微服务可能有着不一样的数据存储需求，数据库也需要通过复制和分片来实现伸缩性
- 这里的微服务的事务就必须限制在自己的数据库中，其他服务要想使用数据必须通过 API 来获取
- 如果使用的是关系型数据库，那么一个服务对应一个 Schema 是实现数据私有化的最佳选择。可以为每一个服务分配不同的数据库用户 ID 来创建这种屏障



<br/>

# Saga 模式

- 如果每一个服务都使用一个数据库，那么在实现跨服务的事务时会出问题，此时需要考虑如何保持数据的一致性
- 本地的 ACID 事务在这里不会起作用，此时可以采用 Saga 模式
- Saga 是一种**本地事务链**，事务链中的每一个事务更新数据库并发布一个**事件**来触发下一个本地事务
- Saga 模式要求在本地事务失败时对事务进行补偿

**Saga 模式的两种实现方式：**

- 编配（Orchestration）：**编配器**负责协调所有的服务执行本地事务、获取更新和执行下一个事件。如果失败，则它负责触发补偿事件
- 编排（Choreography）：每个微服务负责**监听**和**发布**事件，并且在失败时触发补偿事件

注：**编配**比**编排**更容易实现。在编配实现中只有一个组件需要协调所有事件；而在编排视线中，每个微服务都必须监听和响应事件



<br/>

# 断路器模式

在微服务架构中，如果一个事务涉及到多个服务，那么当下游微服务发生故障时，还会继续调用并耗尽所有服务的网络资源，并且还会影响到用户体验

如何解决**级联故障：**

- 在客户端和服务端之间设置一个代理，跟踪连续调用失败的次数，如果超过一个阈值，那么就中断连接并立即**宣告失败**
- 在经过一个超时时间之后，断路器再次允许有限数量的测试请求，检查连接是否可以恢复，否则超时时间重置



<br/>

# 业务能力或子域分解模式

- 在微服务加否中，复杂的大型应用不仅需要进行分解、内聚和松耦合，还必须是自主且足够小的
- 有两种分解方法：
  - 根据业务能力分解：业务能力是产生价值的东西，如航空公司中可以是预定、销售、支付等
  - 根据子域分解：子域的概念来自于领域驱动设计（DDD），一个域由多个子域组成，如产品目录、订单管理、交付管理等



<br/>

# 绞杀榕模式

- 此模式是描述如何将单体应用转化成微服务架构的，绞杀榕模式以藤蔓作为类比，藤蔓会扼死它所缠绕的树。
- 将单体应用程序的一小部分转化为微服务，对于用户而言其外部的 API 保持不变，直至所有部分被重构形成微服务架构



<br/>

# 反腐蚀层模式

- 当现代应用程序需要于遗留应用程序集成时，与过时的基础设施协议、API和数据模型交互将是一项巨大的挑战。坚持旧的模式和语义可能会腐蚀新系统
- 此时需要一个层来装欢两个系统之间的通信。反腐蚀层于遗留系统或新系统的数据模式相匹配，具体取决于他从哪个系统获取数据
- 这样可以确保旧的系统不需要做出改变，同时新系统也不需要在设计和技术方面做出妥协

<br/>

<br/>