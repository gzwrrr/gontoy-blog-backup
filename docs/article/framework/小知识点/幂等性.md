---
title: "幂等性"
shortTitle: "幂等性"
description: "幂等性"
icon: ""
author: 
  name: gzw
  url: 
  email: 1627121193@qq.com
isOriginal: false
date: 2022-11-07
category: 
- "小知识点"
tag:
- "小知识点"
sticky: 1
star: false
article: true
timeline: true
dir:
  text: "幂等性"
  icon: ""
  collapsible: true
  index: true
  comment: true
headerDepth: 3
index: true
order: 2
copy:
  triggerWords: 100
  disableCopy: false
  disableSelection: false
feed:
  title: "幂等性"
  description: "幂等性"
  author:
    name: gzw
    email: 1627121193@qq.com
---







# 幂等性



[[toc]]





## 什么是幂等性？

:::info 说明

幂等性是指一个操作或请求可以被执行多次，但仍然产生相同的结果，而不会引起不必要的副作用或状态变化。

:::



如果一个操作或请求是幂等的，那么它的结果不会随着它被多次执行而变化。这是非常重要的，因为在分布式系统和网络通信中，重复的请求和操作是很常见的情况。如果一个操作不是幂等的，那么重复执行可能会导致数据的损坏或者不一致，因为状态会被多次修改。

一些常见的幂等操作包括读取数据、删除数据、更新数据和向队列中添加消息等。在设计分布式系统和网络协议时，通常需要考虑如何实现幂等性，以确保系统的正确性和可靠性。



:::warning 注意

接口幂等和防止重复提交严格来说不是同一件事

幂等一般是指在已经发生了多次提交的情况下，避免重复提交有副作用

防止重复提交是直接组织用户多次提交

:::



有些情况下是无法阻止重复提交的，比如：

1. 接口超时充实
2. 消息队列中的消息重复消费
3. 网络不稳定请求重发





## 保证幂等性的接口

1. Select 操作：GET、HEAD、OPTIONS 都具有幂等性
2. DELETE 操作：删除一次和多次最终结果是一样的，但是影响的行数可能不一样，需要注意保持幂等性
3. ADD / EDIT 操作：根据具体情况而定





## 实现幂等性的方法

1. 悲观锁：数据库中使用 `for update`，但是一般不适用，效率太低
2. 唯一标识符：针对 **插入操作**，为每个请求生成一个唯一的标识符（例如UUID），并将该标识符与请求一起发送。接收方可以根据标识符判断该请求是否已经处理过，如果已经处理过，则可以直接返回处理结果，避免重复执行。
3. 去重表：本质上也是唯一索引，这种方法适用于在业务中有唯一标的插入场景中，比如在以上的支付场景中，如果一个订单只会支付一次，所以订单ID可以作为唯一标识。这时，我们就可以建一张去重表，并且把唯一标识作为唯一索引，在我们实现时，把创建支付单据和写入去去重表，放在一个事务中，如果重复创建，数据库会抛出唯一约束异常，操作就会回滚。
4. 版本号（乐观锁）：对于可变资源，可以引入版本号的概念。每次更新资源时，都需要指定版本号，如果版本号与当前版本不一致，则说明该请求已经处理过，可以直接返回处理结果。
6. Token：使用Token来保证请求的唯一性，每次请求时需要携带Token，服务端会验证Token的有效性，防止重复请求。
8. 分布式锁：分布式锁实现幂等性的逻辑是，在每次执行方法之前判断，是否可以获取到分布式锁，如果可以，则表示为第一次执行方法，否则直接舍弃请求即可。需要注意的是分布式锁的key必须为业务的唯一标识，通常用redis分布式锁或者zookeeper来实现分布式锁。







